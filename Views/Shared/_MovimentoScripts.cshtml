<script>
    // Habilitar campos no botão "Novo"
    document.getElementById('btnNovo').addEventListener('click', function () {
        // Habilita todos os campos do formulário
        document.querySelectorAll('#movimentoForm input, #movimentoForm select, #movimentoForm textarea').forEach(function (field) {
            field.disabled = false;
        });
        // Habilita o botão "Incluir"
        document.getElementById('btnIncluir').disabled = false;
    });

    // Enviar formulário ao clicar em "Incluir"
    document.getElementById('movimentoForm').addEventListener('submit', function (e) {
        e.preventDefault(); // Previne o comportamento padrão do formulário

        const formData = new FormData(this);

        // Realiza o envio do formulário via POST para criar um novo movimento
        fetch('@Url.Action("Create", "MovimentoManuals")', {
            method: 'POST',
            body: formData
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erro ao salvar o movimento.');
                }
                return response.text(); // Obtém o HTML da Partial View com o grid atualizado
            })
            .then(html => {
                // Substitui o conteúdo do grid com a Partial View retornada
                document.getElementById('gridContainer').innerHTML = html;

                // Desabilita os campos novamente após o envio
                document.querySelectorAll('#movimentoForm input, #movimentoForm select, #movimentoForm textarea').forEach(function (field) {
                    field.disabled = true;
                });

                // Desabilita o botão "Incluir"
                document.getElementById('btnIncluir').disabled = true;

                // Limpa os campos do formulário
                document.getElementById('movimentoForm').reset();
            })
            .catch(error => {
                console.error('Erro ao enviar o formulário:', error);
                alert('Ocorreu um erro ao salvar o movimento. Tente novamente.');
            });
    });
</script>

@* 
<script>
    document.getElementById('btnNovo').addEventListener('click', function () {
        // Habilita os campos
        document.querySelectorAll('#movimentoForm input, #movimentoForm select, #movimentoForm textarea').forEach(function (field) {
            field.disabled = false;
        });
        // Habilita o botão Incluir
        document.getElementById('btnIncluir').disabled = false;
    });

    document.getElementById('movimentoForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const formData = new FormData(this);
        fetch('@Url.Action("GetGrid", "MovimentoManuals")')
            .then(response => response.text()) // Recebe o HTML da Partial View
            .then(html => {
                document.getElementById('gridContainer').innerHTML = html; // Substitui o conteúdo do grid
            })
            .catch(error => console.error('Erro ao atualizar o grid:', error));

        // fetch('@Url.Action("Create", "MovimentoManuals")', {
        //     method: 'POST',
        //     body: formData
        // })
        //     .then(response => response.json())
        //     .then(data => {
        //         // Atualiza o grid com o novo movimento
        //         const grid = document.getElementById('gridMovimentos');
        //         const newRow = `
        //                 <tr>
        //                         <td>${data.DAT_MES}</td>
        //                         <td>${data.DAT_ANO}</td>
        //                         <td>${data.COD_PRODUTO}</td>
        //                         <td>${data.DES_PRODUTO}</td>
        //                         <td>${data.NUM_LANCAMENTO}</td>
        //                         <td>${data.DES_DESCRICAO}</td>
        //                         <td>${data.VAL_VALOR}</td>
        //                         <td><a href="/MovimentoManuals/Edit?mes=${data.DAT_MES}&ano=${data.DAT_ANO}&lancamento=${data.NUM_LANCAMENTO}">Edit</a></td>
        //                 </tr>
        //             `;
        //         grid.insertAdjacentHTML('beforeend', newRow);

                // Desabilita os campos
                document.querySelectorAll('#movimentoForm input, #movimentoForm select, #movimentoForm textarea').forEach(function (field) {
                    field.disabled = true;
                });
                // Desabilita o botão Incluir
                document.getElementById('btnIncluir').disabled = true;
                // Limpa os campos
                document.getElementById('movimentoForm').reset();
            })
            .catch(error => console.error('Erro:', error));
    });

</script> *@